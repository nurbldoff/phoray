<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Phoray</title>
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>

  <div id="sidebar">

    <span id="position"></span>
    <div id="dragbar"></div>

    <div class="wrapper">
      <div class="systems">
        <div class="header">Systems</div>
        <div data-bind="foreach: systems">
          <div data-bind="click: $parent.selected,
                          css: {selected: $parent.selected() == $data}"
               class="system">
            <span data-bind="text: $index"> </span>:
            [<span data-bind="text: type"> </span>]
          </div>
          <div class="elements">
            <div class="header">Sources</div>
            <div data-bind="foreach: sources">
              <div class="element" data-bind="click: $parents[1].select_element,
                                              css: {selected: $parents[1].selected_element() == $data}">
                <span data-bind="text: $index"> </span>:
                <span data-bind="text: name"> </span>
                [<span data-bind="text: type"> </span>]
              </div>
            </div>
          </div>
          <div class="elements">
            <div class="header">Elements</div>
            <div data-bind="foreach: elements">
              <div class="element" data-bind="click: $parents[1].select_element,
                                              css: {selected: $parents[1].selected_element() == $data}">
                <span data-bind="text: $index"> </span>:
                <span data-bind="text: name"> </span>
                [<span data-bind="text: type"> </span>]
              </div>
            </div>
          </div>
        </div>
        <button data-bind="click: add_system">Add</button>
        <button data-bind="click: send">Send</button>
      </div>

      <div data-bind="visible: selected, with: selected">
        <div class="wrapper">
          <div class="attrib system">
            <div class="header">System</div>

            <table>
              <tr>
                <td  class="label">
                  type:
                </td> <td>
                  <select data-bind="value: type, options: type.choices"/>
                </td>
              </tr>

              <!-- ko foreach: args().schema() -->
              <tr data-bind="template: {name: 'property-' + $data.type + '-template',
                             data: {name: $data.name, value: $parent.args()[$data.name]}}">

              </tr>
              <!-- /ko -->

            </table>
            <div>
              <div>
                <button data-bind="click: add_source">Add Source</button>
                <button data-bind="click: add_element">Add Element</button>
              </div> <div>
                <button data-bind="click: trace">Trace</button>
                <button data-bind="click: clear_traces">Clear trace</button>
              </div>
            </div>
          </div>

        </div>

        <div class="wrapper" data-bind="visible: $parent.selected_element,
                                        with: $parent.selected_element">
          <div class="attrib element">
            <div class="header">Element
              <button data-bind="click: $parent.remove">Delete</button>
              <button data-bind="click: $parent.move_up">Up</button>
              <button data-bind="click: $parent.move_down">Down</button>
              <button data-bind="click: $parent.footprint">Footprint</button>
            </div>

            <table>
              <tr>
                <td  class="label">
                  type:
                </td> <td>
                  <select data-bind="value: type, options: type.choices"/>
                </td>
              </tr>

              <!-- ko foreach: args().schema() -->
              <tr data-bind="template: {name: 'property-' + $data.type + '-template',
                             data: {name: $data.name, value: $parent.args()[$data.name]}}">

              </tr>
              <!-- /ko -->

            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="view">
    fesk
    <!-- VIEW -->
  </div>

  <div id="footprint">
    <!-- FOOTPRINT -->
  </div>

  <div id="footer">
    <!-- FOOTER -->
  </div>

  <script type="text/html" id="property-string-template">
      <td class="label" data-bind="text: name + ':'"> </td>
      <td> <input type="text" data-bind="value: value"/> </td>
  </script>

  <script type="text/html" id="property-number-template">
      <td class="label" data-bind="text: name + ':'"> </td>
      <td> <input type="numeric" data-bind="value: value"/> </td>
  </script>

  <script type="text/html" id="property-length-template">
      <td class="label" data-bind="text: name + ':'"> </td>
      <td> <input type="numeric" data-bind="value: value"/> </td>
  </script>

  <script type="text/html" id="property-angle-template">
      <td  class="label" data-bind="text: name + ':'"> </td>
      <td> <input type="numeric" data-bind="value: value"/> </td>
  </script>

  <script type="text/html" id="property-position-template">
      <td colspan="2">
        <div class="label3" data-bind="text: name + ':'"> </div>
        <div class="geometry">
          <table> <tr>
            </tr><tr class="geometry">
              <td class="label"> x: </td>
              <td> <input type="numeric" data-bind="value: value.x"/></td>
              <td class="label"> y: </td>
              <td> <input type="numeric" data-bind="value: value.y"/></td>
              <td class="label"> z: </td>
              <td> <input type="numeric" data-bind="value: value.z"/></td>
            </tr>
          </table>
        </div>
      </td>
  </script>

  <script type="text/html" id="property-rotation-template">
      <td colspan="2">
        <div class="label3" data-bind="text: name + ':'"> </div>
        <div class="geometry">
          <table>
            <tr>
              <td> x: </td>
              <td><input type="numeric" data-bind="value: value.x"/></td>
              <td> y: </td>
              <td><input type="numeric" data-bind="value: value.y"/></td>
              <td> z: </td>
              <td><input type="numeric" data-bind="value: value.z"/></td>
            </tr>
          </table>
        </div>
      </td>
  </script>

  <script type="text/html" id="property-geometry-template">
    <td colspan="2">
      <div class="label2" data-bind="text: name + ':'"></div>
      <div class="geometry">
        <table>
          <tr>
            <td>Type:</td>
            <td>
              <select data-bind="value: value.type, options: value.type.choices"></select>
            </td>
          </tr>
          <!-- ko with: value.args() -->
          <!-- ko foreach: $data.schema() -->
          <tr data-bind="template: {name: 'property-' + $data.type + '-template',
                         data: {name: $data.name, value: $parent[$data.name]}}">
          </tr>
          <!-- /ko -->
          <!-- /ko -->
        </table>
      </div>
    </td>
  </script>


  <script src="js/libs/knockout.js"></script>
  <script src="js/libs/ko.observableDictionary.js"></script>
  <script src="js/libs/knockout.mapping-latest.js"></script>
  <script src="js/libs/ko.numeric.js"></script>
  <script src="js/libs/three.js"></script>
  <script src="js/libs/OrthographicAspectCamera.js"></script>
  <script src="js/libs/TrackballControls.js"></script>
  <script src="js/libs/Detector.js"></script>
  <script src="js/libs/jquery-1.8.3.min.js"></script>
  <script src="js/libs/d3.js"></script>

  <script src="js/scene.js"></script>
  <script src="js/plot.js"></script>
  <script src="js/phoray.js"></script>

  <script>

   // Takes care of resizing the sidebar

   var i = 0,
   sidebar = document.getElementById("sidebar"),
   view = document.getElementById("view"),
   dragbar = document.getElementById("dragbar");

   dragbar.onmousedown = function(e){

        e.preventDefault();
        document.onmousemove = function(e) {
          sidebar.style.width = e.pageX+2 + "px";
          view.style.left = e.pageX+2 + "px";
       };
       console.log("leaving mouseDown");
   };
   document.onmouseup = function(e) {
       document.onmousemove = null;
   };
  </script>

</body>
</html>
